import{r as k,f as O,H as P,h as j,j as u,x as a,k as e,v as g,D as G,E as m,G as C,K as h,F as T,y as S,c as w,w as J,I as Q,l as _,t as $,z as b,u as R,m as N,o as F,q as W}from"./auth-p59NCVpB.js";import{_ as X,d as Y}from"./index-BaOz1LJw.js";import{u as D}from"./ticketStore-Ba3WYzlv.js";import{E as Z}from"./EmptyState-5u2my5Zk.js";const ee={class:"modal fade show d-block"},te={class:"modal-dialog"},se={class:"modal-content rounded-4"},le={class:"modal-header"},ne={class:"modal-title"},ie={class:"modal-body"},oe={class:"mb-3"},ae={class:"mb-3"},re={class:"mb-3"},ue={class:"mb-3"},de={class:"mb-3"},ce={class:"mb-3"},ve=["value"],me={class:"modal-footer"},pe={__name:"TicketFormModal",props:{ticket:Object},emits:["close","saved"],setup(V,{emit:c}){const r=V,f=c,d=D(),v=k([]),i=O({title:r.ticket?.title||"",description:r.ticket?.description||"",status:r.ticket?.status||"open",priority:r.ticket?.priority||"medium",creator:r.ticket?.creator||"",assignee:r.ticket?.assignee||""});P(async()=>{try{const p=await j.get("/admin/users");v.value=p.data}catch{v.value=[]}});async function y(){r.ticket?._id?await d.update(r.ticket._id,i):await d.create(i),f("saved")}return(p,t)=>(a(),u(T,null,[t[18]||(t[18]=e("div",{class:"modal-backdrop fade show"},null,-1)),e("div",ee,[e("div",te,[e("div",se,[e("div",le,[e("h5",ne,g(V.ticket?._id?"Ticket bearbeiten":"Neues Ticket"),1),e("button",{class:"btn-close",onClick:t[0]||(t[0]=n=>p.$emit("close"))})]),e("form",{onSubmit:G(y,["prevent"])},[e("div",ie,[e("div",oe,[t[8]||(t[8]=e("label",null,"Title",-1)),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>i.title=n),class:"form-control",required:""},null,512),[[C,i.title]])]),e("div",ae,[t[9]||(t[9]=e("label",null,"Description",-1)),m(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=n=>i.description=n),class:"form-control",required:""},null,512),[[C,i.description]])]),e("div",re,[t[11]||(t[11]=e("label",null,"Status",-1)),m(e("select",{"onUpdate:modelValue":t[3]||(t[3]=n=>i.status=n),class:"form-select"},t[10]||(t[10]=[e("option",{value:"open"},"Open",-1),e("option",{value:"in_progress"},"In Progress",-1),e("option",{value:"closed"},"Closed",-1)]),512),[[h,i.status]])]),e("div",ue,[t[13]||(t[13]=e("label",null,"Priority",-1)),m(e("select",{"onUpdate:modelValue":t[4]||(t[4]=n=>i.priority=n),class:"form-select"},t[12]||(t[12]=[e("option",{value:"low"},"Low",-1),e("option",{value:"medium"},"Medium",-1),e("option",{value:"high"},"High",-1)]),512),[[h,i.priority]])]),e("div",de,[t[14]||(t[14]=e("label",null,"Creator",-1)),m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>i.creator=n),class:"form-control",required:""},null,512),[[C,i.creator]])]),e("div",ce,[t[16]||(t[16]=e("label",null,"Assignee",-1)),m(e("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>i.assignee=n),class:"form-select"},[t[15]||(t[15]=e("option",{value:""},"– keiner –",-1)),(a(!0),u(T,null,S(v.value,n=>(a(),u("option",{key:n._id,value:n.username},g(n.username),9,ve))),128))],512),[[h,i.assignee]])])]),e("div",me,[e("button",{class:"btn btn-secondary",onClick:t[7]||(t[7]=n=>p.$emit("close")),type:"button"},"Abbrechen"),t[17]||(t[17]=e("button",{class:"btn btn-success",type:"submit"},"Speichern",-1))])],32)])])])],64))}},be={class:"ticketlist-wrapper container py-4"},ke={class:"d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2"},ge={class:"nav nav-tabs mb-3"},fe={class:"nav-item"},ye={class:"nav-item"},we={class:"row g-2 align-items-center mb-3"},$e={class:"col-auto"},he={class:"col-auto"},Te={class:"col-auto"},xe=["value"],_e={key:0,class:"text-center py-5"},Ce={key:1},Se={class:"card shadow-sm rounded-4 border-0"},Ve={class:"card-body p-0"},Le={class:"table table-hover align-middle mb-0 table-striped"},Me={class:"text-end pe-4"},Ue={class:"d-inline-flex gap-1"},Ae=["onClick"],Ne=["onClick"],Fe={key:0},Pe={colspan:"5"},je={key:0,class:"mt-4"},De={class:"pagination justify-content-center"},Be=["onClick"],M=12,Ie={__name:"TicketList",setup(V){const c=D(),r=Y(),f=k(!1),d=k("open"),v=k(""),i=k(""),y=k(""),p=k([]),t=k(1);P(async()=>{try{const o=await j.get("/admin/users");p.value=o.data}catch{r.show("Benutzerliste konnte nicht geladen werden","danger")}n()});async function n(){c.loading=!0;try{await c.loadAll()}catch{r.show("Fehler beim Laden der Tickets","danger")}finally{c.loading=!1}}async function B(o){if(confirm(`Ticket "${o.title}" wirklich löschen?`))try{await c.remove(o._id),r.show("Ticket gelöscht","success"),n()}catch{r.show("Fehler beim Löschen","danger")}}function I(){f.value=!1,n()}const L=w(()=>c.list.filter(o=>o.status===d.value).filter(o=>!v.value||o.title.toLowerCase().includes(v.value.toLowerCase())).filter(o=>!i.value||o.priority===i.value).filter(o=>!y.value||o.assignee?.username===y.value)),U=w(()=>L.value.slice((t.value-1)*M,t.value*M)),x=w(()=>Math.ceil(L.value.length/M));J([L,d],()=>{t.value=1});const q=w(()=>v.value||i.value?"Keine Treffer":d.value==="open"?"Noch keine offenen Tickets":"Keine geschlossenen Tickets"),z=w(()=>v.value||i.value?"Mit den aktuellen Filtern wurden keine Tickets gefunden.":d.value==="open"?"Lege jetzt dein erstes Ticket an!":"Im Moment gibt es keine geschlossenen Tickets.");async function E(o){try{o.status==="closed"?await c.reopen(o._id):await c.close(o._id),r.show("Status aktualisiert","success"),n()}catch{r.show("Fehler beim Umschalten","danger")}}function H(o){switch(o){case"open":return"bg-success text-white";case"in-progress":return"bg-warning text-dark";case"on-hold":return"bg-secondary text-white";case"resolved":return"bg-info text-white";case"closed":return"bg-dark text-white";default:return"bg-light text-dark"}}return(o,s)=>{const K=W("router-link");return a(),u("div",be,[e("div",ke,[s[12]||(s[12]=e("h2",{class:"mb-0 fw-bold text-gradient d-flex align-items-center gap-2"},[e("i",{class:"bi bi-ticket-perforated-fill"}),$(" Tickets ")],-1)),e("button",{class:"btn btn-gradient d-flex align-items-center gap-2 shadow-sm",style:{"min-width":"170px"},onClick:s[0]||(s[0]=l=>f.value=!0)},s[11]||(s[11]=[e("i",{class:"bi bi-plus-circle"},null,-1),$(" Neues Ticket ")]))]),e("ul",ge,[e("li",fe,[e("button",{class:b(["nav-link",{active:d.value==="open"}]),onClick:s[1]||(s[1]=l=>d.value="open")},s[13]||(s[13]=[e("i",{class:"bi bi-unlock"},null,-1),$(" Offen ")]),2)]),e("li",ye,[e("button",{class:b(["nav-link",{active:d.value==="closed"}]),onClick:s[2]||(s[2]=l=>d.value="closed")},s[14]||(s[14]=[e("i",{class:"bi bi-lock"},null,-1),$(" Geschlossen ")]),2)])]),e("div",we,[e("div",$e,[m(e("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>v.value=l),class:"form-control",placeholder:"Suchen…",onInput:s[4]||(s[4]=l=>t.value=1)},null,544),[[C,v.value]])]),e("div",he,[m(e("select",{"onUpdate:modelValue":s[5]||(s[5]=l=>i.value=l),class:"form-select"},s[15]||(s[15]=[e("option",{value:""},"Alle Prioritäten",-1),e("option",{value:"high"},"Hoch",-1),e("option",{value:"medium"},"Mittel",-1),e("option",{value:"low"},"Niedrig",-1)]),512),[[h,i.value]])]),e("div",Te,[m(e("select",{"onUpdate:modelValue":s[6]||(s[6]=l=>y.value=l),class:"form-select"},[s[16]||(s[16]=e("option",{value:""},"Alle Assignees",-1)),(a(!0),u(T,null,S(p.value,l=>(a(),u("option",{key:l._id,value:l.username},g(l.username),9,xe))),128))],512),[[h,y.value]])])]),R(c).loading?(a(),u("div",_e,s[17]||(s[17]=[e("span",{class:"spinner-border text-primary"},null,-1)]))):(a(),u("div",Ce,[e("div",Se,[e("div",Ve,[e("table",Le,[s[21]||(s[21]=e("thead",null,[e("tr",null,[e("th",null,"Titel"),e("th",null,"Status"),e("th",null,"Assignee"),e("th",null,"Priorität"),e("th",{class:"text-end pe-4"},"Aktionen")])],-1)),e("tbody",null,[(a(!0),u(T,null,S(U.value,l=>(a(),u("tr",{key:l._id},[e("td",null,g(l.title),1),e("td",null,[e("span",{class:b(["badge",H(l.status)])},g(l.status),3)]),e("td",null,g(l.assignee?.username||"–"),1),e("td",null,g(l.priority),1),e("td",Me,[e("div",Ue,[N(K,{to:`/tickets/${l._id}`,class:"btn btn-sm btn-outline-primary d-inline-flex align-items-center",title:"Details"},{default:F(()=>s[18]||(s[18]=[e("i",{class:"bi bi-eye-fill"},null,-1)])),_:2,__:[18]},1032,["to"]),e("button",{class:b(["btn btn-sm",l.status==="closed"?"btn-outline-success":"btn-outline-danger"]),onClick:A=>E(l),title:"Status umschalten"},[e("i",{class:b(l.status==="closed"?"bi bi-box-arrow-in-up-right":"bi bi-x-circle")},null,2)],10,Ae),e("button",{class:"btn btn-sm btn-outline-danger d-inline-flex align-items-center",onClick:A=>B(l),title:"Löschen"},s[19]||(s[19]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Ne)])])]))),128)),U.value.length?_("",!0):(a(),u("tr",Fe,[e("td",Pe,[N(Z,{icon:"bi bi-emoji-frown",title:q.value,description:z.value},{default:F(()=>[d.value==="open"?(a(),u("button",{key:0,class:"btn btn-gradient mt-3",onClick:s[7]||(s[7]=l=>f.value=!0)},s[20]||(s[20]=[e("i",{class:"bi bi-plus-circle"},null,-1),$(" Ticket anlegen ")]))):_("",!0)]),_:1},8,["title","description"])])]))])])])]),x.value>1?(a(),u("nav",je,[e("ul",De,[e("li",{class:b(["page-item",{disabled:t.value===1}])},[e("button",{class:"page-link",onClick:s[8]||(s[8]=l=>t.value>1&&--t.value),"aria-label":"Vorherige"},"«")],2),(a(!0),u(T,null,S(x.value,l=>(a(),u("li",{class:b(["page-item",{active:t.value===l}]),key:l},[e("button",{class:"page-link",onClick:A=>t.value=l},g(l),9,Be)],2))),128)),e("li",{class:b(["page-item",{disabled:t.value===x.value}])},[e("button",{class:"page-link",onClick:s[9]||(s[9]=l=>t.value<x.value&&++t.value),"aria-label":"Nächste"},"»")],2)])])):_("",!0)])),f.value?(a(),Q(pe,{key:2,onClose:s[10]||(s[10]=l=>f.value=!1),onSaved:I})):_("",!0)])}}},Ke=X(Ie,[["__scopeId","data-v-a40a85c7"]]);export{Ke as default};
