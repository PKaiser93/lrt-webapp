import{r as b,c as M,H as N,h as v,w as B,j as r,x as a,k as e,D as I,t as p,v as m,E as c,G as h,l as E,K as V,F as $,y as C,I as A,z as q}from"./auth-p59NCVpB.js";import{_ as F,d as O}from"./index-BaOz1LJw.js";import{E as z}from"./EmptyState-5u2my5Zk.js";const D={class:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.4)"},tabindex:"-1"},K={class:"modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable"},P={class:"modal-content shadow-lg"},T={class:"modal-header border-0 bg-gradient-header text-white py-3"},G={class:"modal-title"},H={class:"modal-body p-4"},W={class:"row g-3"},J={class:"col-md-6"},Q={class:"input-group"},X={class:"col-md-6"},Y={class:"input-group"},Z={class:"row g-3 mt-3"},ee={class:"col-md-6"},te={class:"input-group"},se={class:"col-md-6"},ne={class:"input-group"},le={class:"mt-3"},ie={class:"input-group"},ae=["value"],oe={class:"mt-3"},re={class:"input-group"},de=["value"],ue={class:"modal-footer border-0 px-4 pb-4 d-flex justify-content-end gap-2"},me=["disabled"],be=["disabled"],ce={key:0,class:"spinner-border spinner-border-sm me-1"},pe={__name:"StudentEditModal",props:{student:Object},emits:["close","saved"],setup(L,{emit:_}){const w=L,k=_,i=b({_id:"",name:"",vorname:"",idmAccount:"",fauEmail:"",rechner:"",betriebssystem:""}),u=b(!1),f=b([]),y=b([]),x=M(()=>i.value._id+"::"+i.value.betriebssystem);N(async()=>{const o=await v.get("/betriebssystem");f.value=o.data.map(s=>({_id:String(s._id),name:s.name}));const t=await v.get("/computer/search?query=&limit=200");y.value=t.data.map(s=>({_id:String(s._id),dnsName:s.dnsName,marke:s.marke,typ:s.typ}))}),B(()=>w.student,o=>{o?i.value={_id:o._id||"",name:o.name||"",vorname:o.vorname||"",idmAccount:o.idmAccount||"",fauEmail:o.fauEmail||"",rechner:o.rechner||"",betriebssystem:typeof o.betriebssystem=="object"?String(o.betriebssystem._id):String(o.betriebssystem||"")}:Object.assign(i.value,{_id:"",name:"",vorname:"",idmAccount:"",fauEmail:"",rechner:"",betriebssystem:""})},{immediate:!0});async function S(){u.value=!0;try{i.value._id?await v.put(`/studenten/${i.value._id}`,i.value):await v.post("/studenten",i.value),k("saved")}catch(o){alert(o.response?.data?.error||"Fehler beim Speichern")}finally{u.value=!1}}return(o,t)=>(a(),r($,null,[e("div",D,[e("div",K,[e("div",P,[e("form",{onSubmit:I(S,["prevent"])},[e("div",T,[e("h5",G,[t[9]||(t[9]=e("i",{class:"bi bi-pencil-square me-2"},null,-1)),p(" "+m(i.value._id?"Student bearbeiten":"Student anlegen"),1)]),e("button",{type:"button",class:"btn-close btn-close-white",onClick:t[0]||(t[0]=s=>o.$emit("close")),"aria-label":"Schließen"})]),e("div",H,[e("div",W,[e("div",J,[t[11]||(t[11]=e("label",{class:"form-label"},"Nachname",-1)),e("div",Q,[t[10]||(t[10]=e("span",{class:"input-group-text"},[e("i",{class:"bi bi-person-fill"})],-1)),c(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>i.value.name=s),type:"text",class:"form-control",placeholder:"Nachname",required:""},null,512),[[h,i.value.name]])])]),e("div",X,[t[13]||(t[13]=e("label",{class:"form-label"},"Vorname",-1)),e("div",Y,[t[12]||(t[12]=e("span",{class:"input-group-text"},[e("i",{class:"bi bi-person-lines-fill"})],-1)),c(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>i.value.vorname=s),type:"text",class:"form-control",placeholder:"Vorname",required:""},null,512),[[h,i.value.vorname]])])])]),e("div",Z,[e("div",ee,[t[15]||(t[15]=e("label",{class:"form-label"},"IdM‑Account",-1)),e("div",te,[t[14]||(t[14]=e("span",{class:"input-group-text"},[e("i",{class:"bi bi-shield-lock-fill"})],-1)),c(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>i.value.idmAccount=s),type:"text",class:"form-control",placeholder:"IdM‑Account",required:""},null,512),[[h,i.value.idmAccount]])])]),e("div",se,[t[17]||(t[17]=e("label",{class:"form-label"},"FAU E‑Mail",-1)),e("div",ne,[t[16]||(t[16]=e("span",{class:"input-group-text"},[e("i",{class:"bi bi-envelope-fill"})],-1)),c(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>i.value.fauEmail=s),type:"email",class:"form-control",placeholder:"beispiel@fau.de",required:""},null,512),[[h,i.value.fauEmail]])])])]),e("div",le,[t[20]||(t[20]=e("label",{class:"form-label"},"Rechner",-1)),e("div",ie,[t[19]||(t[19]=e("span",{class:"input-group-text"},[e("i",{class:"bi bi-pc-display"})],-1)),c(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>i.value.rechner=s),class:"form-select"},[t[18]||(t[18]=e("option",{value:""},"— Freitext oder Pool wählen —",-1)),(a(!0),r($,null,C(y.value,s=>(a(),r("option",{key:s._id,value:s._id},m(s.dnsName||s.marke||s.typ||s._id),9,ae))),128))],512),[[V,i.value.rechner]])]),y.value.some(s=>s._id===i.value.rechner)?E("",!0):c((a(),r("input",{key:0,"onUpdate:modelValue":t[6]||(t[6]=s=>i.value.rechner=s),type:"text",class:"form-control mt-2",placeholder:"Rechner‑Name oder Pool‑Rechner"},null,512)),[[h,i.value.rechner]])]),e("div",oe,[t[23]||(t[23]=e("label",{class:"form-label"},"Betriebssystem",-1)),e("div",re,[t[22]||(t[22]=e("span",{class:"input-group-text"},[e("i",{class:"bi bi-window-dock"})],-1)),c((a(),r("select",{key:x.value,"onUpdate:modelValue":t[7]||(t[7]=s=>i.value.betriebssystem=s),class:"form-select"},[t[21]||(t[21]=e("option",{value:""},"— auswählen —",-1)),(a(!0),r($,null,C(f.value,s=>(a(),r("option",{key:s._id,value:s._id},m(s.name),9,de))),128))])),[[V,i.value.betriebssystem]])])])]),e("div",ue,[e("button",{type:"button",class:"btn btn-outline-gradient",onClick:t[8]||(t[8]=s=>o.$emit("close")),disabled:u.value},t[24]||(t[24]=[e("i",{class:"bi bi-x-lg me-1"},null,-1),p(" Abbrechen ")]),8,me),e("button",{type:"submit",class:"btn btn-gradient",disabled:u.value},[u.value?(a(),r("span",ce)):E("",!0),t[25]||(t[25]=e("i",{class:"bi bi-check-lg me-1"},null,-1)),p(" "+m(u.value?"Speichern…":"Speichern"),1)],8,be)])],32)])])]),t[26]||(t[26]=e("div",{class:"modal-backdrop fade show"},null,-1))],64))}},ve=F(pe,[["__scopeId","data-v-ea6784e5"]]),fe={class:"studentlist-wrapper container py-4"},ye={class:"d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2"},ge={class:"student-list-actions d-flex flex-wrap align-items-center mb-3 gap-3"},he={class:"input-group search-group"},_e={key:0,class:"text-center py-5"},we={key:1},ke={key:0,class:"table-responsive shadow-sm rounded-4 mb-4"},xe={class:"table table-striped table-hover align-middle mb-0"},Se={class:"badge bg-light text-dark"},$e={class:"badge bg-light text-dark"},Ee={key:0},Ce={key:1,class:"text-muted"},Le={key:0},Ve={key:1,class:"text-muted"},Ae={class:"text-end"},Me={class:"d-inline-flex gap-1"},Ne=["onClick"],Fe=["onClick"],je={__name:"StudentList",setup(L){const _=O(),w=b([]),k=b(!1),i=b(!1),u=b(null),f=b(""),y={};async function x(){k.value=!0;try{(await v.get("/betriebssystem")).data.forEach(l=>y[l._id]=l.name);const n=await v.get("/studenten");w.value=await Promise.all(n.data.map(async l=>{if(l.rechner&&/^[0-9a-f]{24}$/.test(l.rechner))try{l.computerObj=await v.get(`/computer/${l.rechner}`).then(g=>g.data)}catch{}if(l.betriebssystem&&typeof l.betriebssystem=="string"){const g=y[l.betriebssystem];g?l.betriebssystem={_id:l.betriebssystem,name:g}:delete l.betriebssystem}return l}))}catch(d){_.show(d.response?.data?.error||"Fehler beim Laden der Studenten","danger")}finally{k.value=!1}}const S=M(()=>{const d=f.value.trim().toLowerCase();return d?w.value.filter(n=>n.name.toLowerCase().includes(d)||n.vorname.toLowerCase().includes(d)||n.idmAccount.toLowerCase().includes(d)||(n.fauEmail||"").toLowerCase().includes(d)):w.value});function o(){u.value=null,i.value=!0}function t(d){u.value={...d},i.value=!0}function s(){i.value=!1,u.value=null}async function j(){s(),await x()}async function U(d){if(confirm("Wirklich löschen?"))try{await v.delete(`/studenten/${d}`),_.show("Student*in gelöscht","success"),await x()}catch(n){_.show(n.response?.data?.error||"Fehler beim Löschen","danger")}}function R(d){if(!d)return"bi bi-laptop";const n=d.toLowerCase();return n.includes("windows")?"bi bi-windows":n.includes("ubuntu")?"bi bi-ubuntu":n.includes("linux")?"bi bi-hdd-network":n.includes("mac")?"bi bi-apple":n.includes("android")?"bi bi-android":"bi bi-laptop"}return N(x),(d,n)=>(a(),r("div",fe,[e("div",ye,[n[3]||(n[3]=e("h2",{class:"mb-0 text-gradient fw-bold d-flex align-items-center gap-2"},[e("i",{class:"bi bi-mortarboard-fill me-2"}),p("Studenten ")],-1)),e("button",{class:"btn btn-primary d-flex align-items-center gap-2",onClick:n[0]||(n[0]=l=>o())},n[2]||(n[2]=[e("i",{class:"bi bi-plus-circle"},null,-1),p(" Neuen Studenten anlegen ")]))]),e("div",ge,[e("div",he,[n[4]||(n[4]=e("span",{class:"input-group-text"},[e("i",{class:"bi bi-search"})],-1)),c(e("input",{"onUpdate:modelValue":n[1]||(n[1]=l=>f.value=l),type:"text",class:"form-control",placeholder:"Suche nach Name, Vorname, IdM oder E‑Mail…"},null,512),[[h,f.value]])])]),k.value?(a(),r("div",_e,n[5]||(n[5]=[e("div",{class:"spinner-border text-primary",role:"status"},null,-1)]))):(a(),r("div",we,[S.value.length?(a(),r("div",ke,[e("table",xe,[n[10]||(n[10]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Vorname"),e("th",null,"IdM"),e("th",null,"FAU E‑Mail"),e("th",null,"Rechner"),e("th",null,"Betriebssystem"),e("th",{class:"text-end"},"Aktionen")])],-1)),e("tbody",null,[(a(!0),r($,null,C(S.value,l=>(a(),r("tr",{key:l._id},[e("td",null,m(l.name),1),e("td",null,m(l.vorname),1),e("td",null,[e("span",Se,m(l.idmAccount),1)]),e("td",null,[e("span",$e,[n[6]||(n[6]=e("i",{class:"bi bi-envelope me-1"},null,-1)),p(m(l.fauEmail||"–"),1)])]),e("td",null,[l.computerObj?(a(),r("span",Ee,[n[7]||(n[7]=e("i",{class:"bi bi-pc-display-horizontal me-1"},null,-1)),p(" "+m(l.computerObj.dnsName||l.computerObj.marke||l.rechner),1)])):(a(),r("span",Ce,m(l.rechner),1))]),e("td",null,[l.betriebssystem?(a(),r("span",Le,[e("i",{class:q(R(l.betriebssystem.name)+" me-1")},null,2),p(" "+m(l.betriebssystem.name),1)])):(a(),r("span",Ve,"—"))]),e("td",Ae,[e("div",Me,[e("button",{class:"btn btn-sm btn-outline-primary",onClick:g=>t(l),title:"Bearbeiten"},n[8]||(n[8]=[e("i",{class:"bi bi-pencil-square"},null,-1)]),8,Ne),e("button",{class:"btn btn-sm btn-outline-danger",onClick:g=>U(l._id),title:"Löschen"},n[9]||(n[9]=[e("i",{class:"bi bi-trash3"},null,-1)]),8,Fe)])])]))),128))])])])):(a(),A(z,{key:1,icon:"bi bi-emoji-frown",title:"Keine Student*innen gefunden",description:"Lege über den 'Neuen Studenten anlegen'-Button einen neue*n Student*in an."}))])),i.value?(a(),A(ve,{key:2,student:u.value,onClose:s,onSaved:j},null,8,["student"])):E("",!0)]))}},Ie=F(je,[["__scopeId","data-v-36ae3419"]]);export{Ie as default};
